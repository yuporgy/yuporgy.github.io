<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Äî –ú–æ–∫–∞–ø—ã</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f1219;
      --bg-card: #1a1f2e;
      --bg-card-hover: #252d3d;
      --border: #3d3a32;
      --text: #e8eaef;
      --text-muted: #9a9589;
      --accent: #d4a017;
      --accent-hover: #e8b923;
      --accent-light: #f0c94a;
      --success: #34c759;
      --warning: #e8b923;
      --danger: #ff453a;
      --progress-bg: #2d2a24;
      --radius: 12px;
      --radius-sm: 8px;
      --shadow: 0 4px 24px rgba(0,0,0,0.4);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Manrope', -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.5;
    }

    .app {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      padding: 20px;
      position: relative;
    }

    @media (max-width: 499px) {
      #questions-list { grid-template-columns: 1fr; }
      #questions-list .question-item { min-width: unset; }
    }
    @media (min-width: 768px) {
      .app { max-width: 700px; padding: 32px; }
      .card-grid { grid-template-columns: repeat(3, 1fr); }
      #screen1-level-chips.chips-full { flex-direction: row; flex-wrap: nowrap; }
      #screen1-level-chips.chips-full .chip { width: auto; flex: 1; min-width: 0; }
      .hub-cards { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
      #companies-list, #categories-list {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }
      #companies-list .card, #categories-list .card { margin-bottom: 0; }
      #questions-list {
        display: grid;
        grid-template-columns: repeat(2, minmax(200px, 1fr));
        gap: 12px;
      }
      #questions-list .question-item { margin-bottom: 0; min-width: 200px; }
    }

    .screen { display: none; animation: fadeIn 0.2s ease; }
    .screen.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
    }
    .btn-back {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
      background: var(--bg-card);
      color: var(--text);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      transition: all 0.2s;
    }
    .btn-back:hover { background: var(--bg-card-hover); border-color: var(--accent); color: var(--accent); }
    .header h1 { font-size: 1.25rem; font-weight: 700; }

    h2 { font-size: 1.5rem; font-weight: 700; margin-bottom: 24px; }
    .subtitle { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 20px; }

    .progress-bar {
      height: 8px;
      background: var(--progress-bg);
      border-radius: 4px;
      overflow: hidden;
      margin: 8px 0 4px;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-light));
      border-radius: 4px;
      transition: width 0.3s;
    }
    .progress-text { font-size: 0.85rem; color: var(--text-muted); }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 20px;
    }
    .chip {
      padding: 8px 16px;
      border-radius: 20px;
      border: 1px solid var(--border);
      background: var(--bg-card);
      color: var(--text);
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .chip:hover { border-color: var(--accent); background: var(--bg-card-hover); }
    .chip.active { background: var(--accent); border-color: var(--accent); color: #fff; }
    .chip.small { padding: 6px 12px; font-size: 0.8rem; }
    .chips-full { flex-direction: column; }
    .chips-full .chip { width: 100%; display: flex; justify-content: center; align-items: center; }

    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px 20px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .card:hover { background: var(--bg-card-hover); border-color: var(--accent); transform: translateY(-1px); }
    .card.selected { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(212,160,23,0.35); }
    .card-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 24px; }
    .card-grid .card { margin-bottom: 0; display: flex; flex-direction: row; align-items: center; gap: 12px; padding: 16px 20px; text-align: left; }
    .card-grid .card-icon { font-size: 1.75rem; flex-shrink: 0; margin-bottom: 0; }
    .card-grid .card-title { font-weight: 600; margin-bottom: 2px; }
    .card-grid .card-desc { font-size: 0.8rem; color: var(--text-muted); display: block; margin-top: 2px; }
    .card-meta { font-size: 0.85rem; color: var(--text-muted); margin-top: 8px; }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 14px 24px;
      border-radius: var(--radius-sm);
      font-size: 1rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      width: 100%;
    }
    .btn-primary {
      background: var(--accent);
      color: #fff;
      margin-top: 24px;
    }
    .btn-primary:hover { background: var(--accent-hover); }
    .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-secondary {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text);
    }
    .btn-secondary:hover { border-color: var(--accent); color: var(--accent); }
    .btn-block { margin-top: 12px; }

    .hub-cards { display: flex; flex-direction: column; gap: 12px; margin: 20px 0; }
    .hub-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: flex-start;
      gap: 16px;
    }
    .hub-card:hover { border-color: var(--accent); }
    .hub-card-icon { font-size: 2rem; }
    .hub-card-content { flex: 1; }
    .hub-card-title { font-weight: 600; margin-bottom: 4px; }
    .hub-card-desc { font-size: 0.85rem; color: var(--text-muted); }
    .hub-card-progress { font-size: 0.8rem; color: var(--accent); margin-top: 8px; }

    .link-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 0;
      color: var(--accent);
      cursor: pointer;
      font-size: 0.95rem;
      border: none;
      background: none;
      margin-top: 16px;
    }
    .link-btn:hover { text-decoration: underline; }

    .breadcrumb { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 16px; }
    .question-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      min-width: 0;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .question-item:hover { border-color: var(--accent); }
    .question-thumb {
      width: 48px; height: 36px; object-fit: cover; border-radius: 6px; flex-shrink: 0;
    }
    .question-num { font-weight: 600; min-width: 24px; }
    .question-preview { flex: 1; font-size: 0.9rem; color: var(--text-muted); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .question-status { font-size: 1rem; }
    .star { cursor: pointer; color: var(--text-muted); }
    .star.filled { color: var(--warning); }
    .status-ok { color: var(--success); }
    .status-fail { color: var(--danger); }

    .question-card { position: relative; background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 24px; margin: 20px 0; }
    .question-card .star { position: absolute; top: 16px; right: 16px; }
    .question-context { font-size: 0.85rem; color: var(--text-muted); }
    .question-text { font-size: 1.05rem; line-height: 1.6; margin-bottom: 24px; white-space: pre-wrap; }
    .question-image {
      max-width: 100%; border-radius: var(--radius-sm); margin: 16px 0; display: block;
    }
    textarea {
      width: 100%;
      min-height: 100px;
      padding: 14px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
      background: var(--bg);
      color: var(--text);
      font-family: inherit;
      font-size: 0.95rem;
      resize: vertical;
      margin-bottom: 16px;
    }
    textarea:focus, input[type="text"]:focus { outline: none; border-color: var(--accent); }
    input[type="text"] {
      width: 100%;
      padding: 14px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
      background: var(--bg);
      color: var(--text);
      font-family: inherit;
      font-size: 1rem;
      margin-bottom: 16px;
    }
    .radio-option, .checkbox-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      margin-bottom: 8px;
      cursor: pointer;
    }
    .radio-option:hover, .checkbox-option:hover { border-color: var(--accent); }
    .radio-option.selected, .checkbox-option.selected { border-color: var(--accent); background: rgba(212,160,23,0.18); }
    .hint-block {
      background: rgba(255,159,10,0.1);
      border: 1px solid rgba(255,159,10,0.3);
      border-radius: var(--radius-sm);
      padding: 16px;
      margin: 16px 0;
      font-size: 0.9rem;
    }
    .answer-block {
      background: rgba(52,199,89,0.1);
      border: 1px solid rgba(52,199,89,0.3);
      border-radius: var(--radius-sm);
      padding: 16px;
      margin: 16px 0;
      font-size: 0.9rem;
    }
    .answer-block.incorrect { background: rgba(255,69,58,0.1); border-color: rgba(255,69,58,0.3); }
    .question-nav { display: flex; gap: 12px; margin-top: 24px; align-items: stretch; }
    .question-nav .btn { flex: 1; margin-top: 0 !important; min-height: 48px; }

    .empty-state {
      text-align: center;
      padding: 48px 24px;
      color: var(--text-muted);
      font-size: 0.95rem;
    }
    .empty-state-icon { font-size: 3rem; margin-bottom: 16px; opacity: 0.5; }

    .progress-section { margin-bottom: 24px; }
    .progress-section h3 { font-size: 0.95rem; font-weight: 600; margin-bottom: 12px; color: var(--text-muted); }
    .progress-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid var(--border);
      font-size: 0.9rem;
      cursor: pointer;
    }
    .progress-row:hover { color: var(--accent); }
    .progress-row:last-child { border-bottom: none; }
    .progress-row .mini-bar {
      width: 80px;
      height: 6px;
      background: var(--progress-bg);
      border-radius: 3px;
      overflow: hidden;
    }
    .progress-row .mini-fill { height: 100%; background: var(--accent); border-radius: 3px; }
    .progress-row:hover { color: var(--accent); }
    .recommendation {
      background: rgba(255,159,10,0.1);
      border-radius: var(--radius-sm);
      padding: 16px;
      margin-top: 20px;
      font-size: 0.9rem;
    }
    .recommendation strong { color: var(--warning); }

    .test-result {
      text-align: center;
      padding: 32px 24px;
    }
    .test-result-icon { font-size: 4rem; margin-bottom: 16px; }
    .test-result-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 8px; }
    .test-result-score {
      font-size: 3rem;
      font-weight: 700;
      color: var(--accent);
      margin: 24px 0 8px;
    }
    .test-result-detail { font-size: 1.1rem; color: var(--text-muted); margin-bottom: 24px; }
    .test-result-context { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 32px; }
    .test-result-buttons { display: flex; flex-direction: column; gap: 12px; }

    .top-bar {
      display: none;
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      padding: 0 0 20px;
      margin-bottom: 4px;
    }
    .top-bar.visible { display: flex; }
    .top-bar-left {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
      min-width: 0;
    }
    .top-bar-left h2 { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .user-dropdown { position: relative; }
    .user-account {
      cursor: pointer;
      padding: 8px 12px;
      border-radius: var(--radius-sm);
      font-size: 0.95rem;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .user-account:hover { background: var(--bg-card); }
    .user-menu {
      display: none;
      position: absolute;
      top: calc(100% + 4px);
      right: 0;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 8px 0;
      min-width: 140px;
      box-shadow: var(--shadow);
      z-index: 100;
    }
    .user-menu.open { display: block; }
    .user-menu a {
      display: block;
      padding: 10px 16px;
      color: var(--text);
      text-decoration: none;
      font-size: 0.9rem;
      cursor: pointer;
    }
    .user-menu a:hover { background: var(--bg-card-hover); color: var(--accent); }

    .login-screen {
      max-width: 360px;
      margin: 0 auto;
      padding-top: 48px;
    }
    .login-screen h2 { text-align: center; margin-bottom: 8px; }
    .login-screen .subtitle { text-align: center; margin-bottom: 32px; }
    .login-screen input {
      width: 100%;
      padding: 14px 16px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
      background: var(--bg);
      color: var(--text);
      font-size: 1rem;
      margin-bottom: 16px;
    }
    .login-screen input:focus { outline: none; border-color: var(--accent); }
  </style>
</head>
<body>
  <div class="app">
    <div class="top-bar" id="top-bar">
      <div class="top-bar-left">
        <button class="btn-back" id="top-bar-back" onclick="handleTopBarBack()" style="display:none;flex-shrink:0">‚Üê</button>
        <h2 id="top-bar-title" style="margin:0;font-size:1.5rem">–ö —á–µ–º—É –≥–æ—Ç–æ–≤–∏—à—å—Å—è?</h2>
      </div>
      <div class="user-dropdown">
        <div class="user-account" onclick="toggleUserMenu(event)">
          <span id="user-name">–ê–ª–µ–∫—Å–µ–π</span>
          <span style="font-size:0.7em">‚ñº</span>
        </div>
        <div class="user-menu" id="user-menu">
        <a onclick="showScreen(7);closeUserMenu()">‚≠ê –ò–∑–±—Ä–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã (3)</a>
        <a onclick="showScreen(8);closeUserMenu()">üìä –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å</a>
        <a onclick="showProfile();closeUserMenu()">–ü—Ä–æ—Ñ–∏–ª—å</a>
        <a onclick="logout();closeUserMenu()">–í—ã–π—Ç–∏</a>
        </div>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω 0: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
    <div id="screen-0" class="screen active">
      <div class="login-screen">
        <h2>–í—Ö–æ–¥</h2>
        <p class="subtitle">–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ –≤–æ–ø—Ä–æ—Å–æ–≤</p>
        <input type="text" id="login-input" placeholder="–õ–æ–≥–∏–Ω –∏–ª–∏ email" onkeypress="if(event.key==='Enter')doLogin()">
        <input type="password" id="password-input" placeholder="–ü–∞—Ä–æ–ª—å" onkeypress="if(event.key==='Enter')doLogin()">
        <button class="btn btn-primary" onclick="doLogin()">–í–æ–π—Ç–∏</button>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω 1: –í—ã–±–æ—Ä —Ä–æ–ª–∏ –∏ –≥—Ä–µ–π–¥–∞ -->
    <div id="screen-1" class="screen">
      <p class="subtitle">–í—ã–±–µ—Ä–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ —É—Ä–æ–≤–µ–Ω—å ‚Äî –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –ø–∞—Ä–µ ¬´–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ + –≥—Ä–µ–π–¥¬ª</p>
      <div class="card-grid" id="roles-grid">
        <div class="card" data-role="frontend">
          <span class="card-icon">‚öõÔ∏è</span>
          <div><span class="card-title">Frontend</span><span class="card-desc">React, Vue, JS</span></div>
        </div>
        <div class="card" data-role="backend">
          <span class="card-icon">‚öôÔ∏è</span>
          <div><span class="card-title">Backend</span><span class="card-desc">–°–µ—Ä–≤–µ—Ä—ã, API</span></div>
        </div>
        <div class="card" data-role="fullstack">
          <span class="card-icon">üîó</span>
          <div><span class="card-title">Fullstack</span><span class="card-desc">Full stack</span></div>
        </div>
        <div class="card" data-role="qa">
          <span class="card-icon">üß™</span>
          <div><span class="card-title">QA</span><span class="card-desc">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</span></div>
        </div>
        <div class="card" data-role="data">
          <span class="card-icon">üìä</span>
          <div><span class="card-title">Data</span><span class="card-desc">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞, ML</span></div>
        </div>
        <div class="card" data-role="devops">
          <span class="card-icon">üê≥</span>
          <div><span class="card-title">DevOps</span><span class="card-desc">–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞</span></div>
        </div>
      </div>
      <p class="subtitle" style="margin-top:24px">–í—ã–±–µ—Ä–∏ —É—Ä–æ–≤–µ–Ω—å:</p>
      <div class="chips chips-full" id="screen1-level-chips">
        <span class="chip" data-level="junior">–î–∂—É–Ω–∏–æ—Ä</span>
        <span class="chip" data-level="middle">–ú–∏–¥–ª</span>
        <span class="chip" data-level="senior">–°–µ–Ω—å–æ—Ä</span>
      </div>
      <p class="progress-text" id="screen1-level-hint" style="margin-top:-8px;margin-bottom:16px">–í–µ—Ä–Ω–∏—Å—å —Å—é–¥–∞ –ø–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π</p>
      <button class="btn btn-primary" id="btn-continue" disabled>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω 2: –ì–ª–∞–≤–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <div id="screen-2" class="screen">
      <p class="progress-text" id="hub-progress" style="margin:0 0 8px">–†–µ—à–µ–Ω–æ 12 –∏–∑ 40 ‚Ä¢ 30%</p>
      <div class="progress-bar"><div class="progress-fill" id="hub-progress-bar" style="width: 30%"></div></div>
      <div class="hub-cards">
        <div class="hub-card" onclick="showScreen(3)">
          <span class="hub-card-icon">üè¢</span>
          <div class="hub-card-content">
            <div class="hub-card-title">–ü–æ –∫–æ–º–ø–∞–Ω–∏—è–º</div>
            <div class="hub-card-desc">–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã –≤ –¢-–ë–∞–Ω–∫, –°–±–µ—Ä, –Ø–Ω–¥–µ–∫—Å‚Ä¶</div>
            <div class="hub-card-progress">3 –∏–∑ 8 –∫–æ–º–ø–∞–Ω–∏–π —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º</div>
          </div>
        </div>
        <div class="hub-card" onclick="showScreen(4)">
          <span class="hub-card-icon">üìö</span>
          <div class="hub-card-content">
            <div class="hub-card-title">–ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</div>
            <div class="hub-card-desc">–¢–µ–º—ã: –∞–ª–≥–æ—Ä–∏—Ç–º—ã, JS, SQL, —Å–æ—Ñ—Ç-—Å–∫–∏–ª–ª—ã</div>
            <div class="hub-card-progress">5 –∏–∑ 12 —Ç–µ–º —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º</div>
          </div>
        </div>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω 3: –°–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π -->
    <div id="screen-3" class="screen">
      <div class="chips">
        <span class="chip active small">–í—Å–µ</span>
        <span class="chip small">–ù–µ –Ω–∞—á–∞—Ç—ã–µ</span>
        <span class="chip small">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
        <span class="chip small">–ü—Ä–æ–π–¥–µ–Ω–Ω—ã–µ</span>
      </div>
      <p class="subtitle">–£—Ä–æ–≤–µ–Ω—å: <strong id="companies-level">–î–∂—É–Ω–∏–æ—Ä</strong></p>
      <div id="companies-list">
        <div class="card" onclick="openQuestions('company', '–¢-–ë–∞–Ω–∫')">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <span class="card-title">–¢-–ë–∞–Ω–∫</span>
            <span class="card-meta">3/10 ‚Ä¢ 30%</span>
          </div>
          <div class="progress-bar"><div class="progress-fill" style="width:30%"></div></div>
          <span style="font-size:0.8rem;color:var(--warning)">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
        </div>
        <div class="card" onclick="openQuestions('company', '–°–±–µ—Ä')">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <span class="card-title">–°–±–µ—Ä</span>
            <span class="card-meta">0/10 ‚Ä¢ 0%</span>
          </div>
          <div class="progress-bar"><div class="progress-fill" style="width:0%"></div></div>
          <span style="font-size:0.8rem;color:var(--text-muted)">–ù–µ –Ω–∞—á–∞—Ç–∞</span>
        </div>
        <div class="card" onclick="openQuestions('company', '–Ø–Ω–¥–µ–∫—Å')">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <span class="card-title">–Ø–Ω–¥–µ–∫—Å</span>
            <span class="card-meta">5/10 ‚Ä¢ 50%</span>
          </div>
          <div class="progress-bar"><div class="progress-fill" style="width:50%"></div></div>
          <span style="font-size:0.8rem;color:var(--warning)">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
        </div>
        <div class="card" onclick="openQuestions('company', 'VK')">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <span class="card-title">VK</span>
            <span class="card-meta">4/10 ‚Ä¢ 40%</span>
          </div>
          <div class="progress-bar"><div class="progress-fill" style="width:40%"></div></div>
          <span style="font-size:0.8rem;color:var(--warning)">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
        </div>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω 4: –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
    <div id="screen-4" class="screen">
      <p class="subtitle">–£—Ä–æ–≤–µ–Ω—å: <strong id="categories-level">–î–∂—É–Ω–∏–æ—Ä</strong></p>
      <div id="categories-list">
        <div class="card" onclick="openQuestions('category', '–ê–ª–≥–æ—Ä–∏—Ç–º—ã')">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <span class="card-title">üßÆ –ê–ª–≥–æ—Ä–∏—Ç–º—ã</span>
            <span class="card-meta">2/10 ‚Ä¢ 20%</span>
          </div>
          <div class="progress-bar"><div class="progress-fill" style="width:20%"></div></div>
          <span style="font-size:0.8rem;color:var(--warning)">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
        </div>
        <div class="card" onclick="openQuestions('category', 'JavaScript')">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <span class="card-title">üìú JavaScript</span>
            <span class="card-meta">4/10 ‚Ä¢ 40%</span>
          </div>
          <div class="progress-bar"><div class="progress-fill" style="width:40%"></div></div>
          <span style="font-size:0.8rem;color:var(--warning)">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
        </div>
        <div class="card" onclick="openQuestions('category', 'SQL')">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <span class="card-title">üóÑÔ∏è SQL</span>
            <span class="card-meta">0/10 ‚Ä¢ 0%</span>
          </div>
          <div class="progress-bar"><div class="progress-fill" style="width:0%"></div></div>
          <span style="font-size:0.8rem;color:var(--text-muted)">–ù–µ –Ω–∞—á–∞—Ç–∞</span>
        </div>
        <div class="card" onclick="openQuestions('category', '–ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ')">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <span class="card-title">üí¨ –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ</span>
            <span class="card-meta">4/10 ‚Ä¢ 40%</span>
          </div>
          <div class="progress-bar"><div class="progress-fill" style="width:40%"></div></div>
          <span style="font-size:0.8rem;color:var(--warning)">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
        </div>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω 5: –°–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ -->
    <div id="screen-5" class="screen">
      <button class="btn btn-primary btn-block" onclick="startQuestionsInRow()">–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç</button>
      <div id="questions-list" style="margin-top:20px"></div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω 6: –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–æ–ø—Ä–æ—Å–∞ -->
    <div id="screen-6" class="screen">
      <div class="question-card">
        <span class="star" id="fav-star" onclick="toggleFavorite()">‚òÜ</span>
        <div class="question-text" id="question-text"></div>
        <div id="question-image-wrap"></div>
        <div id="answer-area">
          <div id="answer-input-area"></div>
          <button class="btn btn-secondary" style="margin-bottom:8px" onclick="toggleHint()">üí° –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É</button>
          <div id="hint-block" class="hint-block" style="display:none"></div>
          <button class="btn btn-primary" onclick="checkAnswer()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        </div>
        <div id="result-area" style="display:none">
          <div class="answer-block" id="correct-answer-block">
            <strong>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:</strong><br>
            <span id="correct-answer-text"></span>
          </div>
          <div class="question-nav">
            <button class="btn btn-secondary" onclick="prevQuestion()">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π</button>
            <button class="btn btn-primary" id="btn-next-question" onclick="nextQuestion()">–°–ª–µ–¥—É—é—â–∏–π ‚Üí</button>
          </div>
          <button class="btn btn-secondary btn-block" onclick="backToQuestionsList()">–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</button>
        </div>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω 7: –ò–∑–±—Ä–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã -->
    <div id="screen-7" class="screen">
      <button class="btn btn-primary btn-block" id="btn-favorites-test" onclick="startFavoritesTest()" style="margin-bottom:20px">‚≠ê –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –ø–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–º (3)</button>
      <div id="favorites-list">
        <div class="card" onclick="openQuestionFromFav(1)">
          <div class="card-title">–í —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É let –∏ const?</div>
          <div class="card-meta">–¢-–ë–∞–Ω–∫ ‚Ä¢ –î–∂—É–Ω–∏–æ—Ä ‚Ä¢ –û—Ç–≤–µ—á–µ–Ω –≤–µ—Ä–Ω–æ</div>
          <button class="btn btn-secondary" style="padding:8px 16px;margin-top:8px;font-size:0.85rem" onclick="event.stopPropagation();removeFavorite(this)">–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ</button>
        </div>
        <div class="card" onclick="openQuestionFromFav(2)">
          <div class="card-title">–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø—Ä–æ –ø–∞—Ç—Ç–µ—Ä–Ω Singleton</div>
          <div class="card-meta">–ê–ª–≥–æ—Ä–∏—Ç–º—ã ‚Ä¢ –ú–∏–¥–ª ‚Ä¢ –ù–µ –æ—Ç–≤–µ—á–µ–Ω</div>
          <button class="btn btn-secondary" style="padding:8px 16px;margin-top:8px;font-size:0.85rem" onclick="event.stopPropagation();removeFavorite(this)">–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ</button>
        </div>
        <div class="card" onclick="openQuestionFromFav(3)">
          <div class="card-title">–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç virtual DOM?</div>
          <div class="card-meta">JavaScript ‚Ä¢ –î–∂—É–Ω–∏–æ—Ä ‚Ä¢ –û—Ç–≤–µ—á–µ–Ω –Ω–µ–≤–µ—Ä–Ω–æ</div>
          <button class="btn btn-secondary" style="padding:8px 16px;margin-top:8px;font-size:0.85rem" onclick="event.stopPropagation();removeFavorite(this)">–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ</button>
        </div>
      </div>
      <div id="favorites-empty" class="empty-state" style="display:none">
        <div class="empty-state-icon">‚≠ê</div>
        <p>–ü–æ–∫–∞ –Ω–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤.</p>
        <p style="margin-top:8px">–û—Ç–º–µ—á–∞–π—Ç–µ –∑–≤—ë–∑–¥–æ—á–∫–æ–π –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ ‚Äî –æ–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å.</p>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω 8: –ü—Ä–æ–≥—Ä–µ—Å—Å -->
    <div id="screen-8" class="screen">
      <div class="chips" style="margin-bottom:24px">
        <span class="chip active" id="progress-role-chip" onclick="showScreen(1)">Frontend ‚Ä¢ –î–∂—É–Ω–∏–æ—Ä</span>
      </div>
      <div class="progress-section">
        <h3>–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —É—Ä–æ–≤–Ω—é</h3>
        <div class="progress-bar"><div class="progress-fill" id="progress-overall-bar" style="width:30%"></div></div>
        <p class="progress-text" id="progress-overall-text">–†–µ—à–µ–Ω–æ 12 –∏–∑ 40 –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Ä¢ 30%</p>
      </div>
      <div class="progress-section">
        <h3>–ü–æ —É—Ä–æ–≤–Ω—è–º</h3>
        <div class="progress-row">
          <span>–î–∂—É–Ω–∏–æ—Ä</span>
          <div class="mini-bar"><div class="mini-fill" style="width:30%"></div></div>
          <span>12/40</span>
        </div>
        <div class="progress-row">
          <span>–ú–∏–¥–ª</span>
          <div class="mini-bar"><div class="mini-fill" style="width:0%"></div></div>
          <span>0/20</span>
        </div>
        <div class="progress-row">
          <span>–°–µ–Ω—å–æ—Ä</span>
          <div class="mini-bar"><div class="mini-fill" style="width:0%"></div></div>
          <span>0/20</span>
        </div>
      </div>
      <div class="progress-section">
        <h3>–ü–æ –∫–æ–º–ø–∞–Ω–∏—è–º</h3>
        <div class="progress-row" onclick="openQuestions('company','–¢-–ë–∞–Ω–∫')">
          <span>–¢-–ë–∞–Ω–∫</span>
          <div class="mini-bar"><div class="mini-fill" style="width:30%"></div></div>
          <span>3/10</span>
        </div>
        <div class="progress-row" onclick="openQuestions('company','–°–±–µ—Ä')">
          <span>–°–±–µ—Ä</span>
          <div class="mini-bar"><div class="mini-fill" style="width:0%"></div></div>
          <span>0/10</span>
        </div>
        <div class="progress-row" onclick="openQuestions('company','–Ø–Ω–¥–µ–∫—Å')">
          <span>–Ø–Ω–¥–µ–∫—Å</span>
          <div class="mini-bar"><div class="mini-fill" style="width:50%"></div></div>
          <span>5/10</span>
        </div>
      </div>
      <div class="progress-section">
        <h3>–ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h3>
        <div class="progress-row" onclick="openQuestions('category','–ê–ª–≥–æ—Ä–∏—Ç–º—ã')">
          <span>–ê–ª–≥–æ—Ä–∏—Ç–º—ã</span>
          <div class="mini-bar"><div class="mini-fill" style="width:20%"></div></div>
          <span>2/10</span>
        </div>
        <div class="progress-row" onclick="openQuestions('category','JavaScript')">
          <span>JavaScript</span>
          <div class="mini-bar"><div class="mini-fill" style="width:40%"></div></div>
          <span>4/10</span>
        </div>
      </div>
      <div class="recommendation">
        <strong>–°–ª–∞–±—ã–µ –º–µ—Å—Ç–∞:</strong> –ê–ª–≥–æ—Ä–∏—Ç–º—ã (20% –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö), –°–∏—Å—Ç–µ–º–Ω—ã–π –¥–∏–∑–∞–π–Ω (–Ω–µ –Ω–∞—á–∞—Ç)
      </div>
      <button class="btn btn-primary btn-block" onclick="showScreen(2)" style="margin-top:24px">–í –±–∏–±–ª–∏–æ—Ç–µ–∫—É</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω 9: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ -->
    <div id="screen-9" class="screen">
      <div class="test-result">
        <div class="test-result-icon" id="result-icon">üéâ</div>
        <div class="test-result-title" id="result-title">–¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω!</div>
        <div class="test-result-score" id="result-score">7/10</div>
        <div class="test-result-detail" id="result-detail">70% –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>
        <div class="test-result-context" id="result-context">–¢-–ë–∞–Ω–∫ ‚Ä¢ –î–∂—É–Ω–∏–æ—Ä</div>
        <div class="test-result-buttons">
          <button class="btn btn-primary" id="btn-retake" onclick="retakeTest()">–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –µ—â—ë —Ä–∞–∑</button>
          <button class="btn btn-secondary" id="btn-to-list" onclick="backToQuestionsFromResult()">–ö —Å–ø–∏—Å–∫—É –≤–æ–ø—Ä–æ—Å–æ–≤</button>
          <button class="btn btn-secondary" onclick="showScreenFromResult()">–í –±–∏–±–ª–∏–æ—Ç–µ–∫—É</button>
        </div>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω 10: –ü—Ä–æ—Ñ–∏–ª—å -->
    <div id="screen-10" class="screen">
      <div class="card" style="cursor:default;margin-bottom:20px">
        <div style="margin-bottom:12px">
          <span class="progress-text">–ò–º—è</span>
          <div style="font-size:1.1rem;margin-top:4px" id="profile-name">–ê–ª–µ–∫—Å–µ–π</div>
        </div>
        <div>
          <span class="progress-text">Email</span>
          <div style="font-size:1.1rem;margin-top:4px" id="profile-email">alexey@example.com</div>
        </div>
      </div>
      <button class="btn btn-secondary" onclick="logout()">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
    </div>
  </div>

  <script>
    const TOTAL_QUESTIONS = 10;

    const QUESTIONS_DATA = [
      { text: '–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ JS?', type: 'short', placeholder: '–û–¥–Ω–æ —Å–ª–æ–≤–æ', hint: '–ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–∞ c...', answer: 'const' },
      { text: '== –∏ === ‚Äî –∫–∞–∫–æ–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç—Ä–æ–≥–æ (—Ç–∏–ø + –∑–Ω–∞—á–µ–Ω–∏–µ)?', type: 'choice', options: ['==', '==='], correct: 1, hint: '–¢—Ä–∏ —Å–∏–º–≤–æ–ª–∞', answer: '===', image: 'https://picsum.photos/400/200?random=4' },
      { text: '–§—É–Ω–∫—Ü–∏—è –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏, —Å–æ—Ö—Ä–∞–Ω—è—é—â–∞—è –¥–æ—Å—Ç—É–ø –∫ –≤–Ω–µ—à–Ω–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π ‚Äî —ç—Ç–æ?', type: 'short', placeholder: '–û–¥–Ω–æ —Å–ª–æ–≤–æ', hint: 'Closure', answer: '–∑–∞–º—ã–∫–∞–Ω–∏–µ' },
      { text: '–ö–∞–∫–æ–π —Ü–∏–∫–ª –≤ JS –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏?', type: 'choice', options: ['Event loop', 'For loop', 'While loop'], correct: 0, hint: '–°–æ–±—ã—Ç–∏–π–Ω—ã–π', answer: 'Event loop' },
      { text: '–ü—Ä–æ–º–∏—Å—ã: resolve –∏–ª–∏ reject ‚Äî —á—Ç–æ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ?', type: 'choice', options: ['resolve', 'reject'], correct: 0, hint: '–†–∞–∑—Ä–µ—à–∏—Ç—å', answer: 'resolve' },
      { text: '–°–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –ø—Ä–æ–º–∏—Å–∞ (–∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ)?', type: 'short', placeholder: '–û–¥–Ω–æ —Å–ª–æ–≤–æ', hint: 'async/...', answer: 'await' },
      { text: 'React –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π DOM –Ω–∞–ø—Ä—è–º—É—é?', type: 'choice', options: ['–î–∞', '–ù–µ—Ç, —á–µ—Ä–µ–∑ Virtual DOM'], correct: 1, hint: '–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π', answer: '–ù–µ—Ç, —á–µ—Ä–µ–∑ Virtual DOM' },
      { text: '–ü–æ–¥–Ω—è—Ç–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–π ‚Äî –∫–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è?', type: 'short', placeholder: '–ê–Ω–≥–ª–∏–π—Å–∫–æ–µ —Å–ª–æ–≤–æ', hint: 'Hoisting', answer: 'hoisting' },
      { text: 'call, apply, bind ‚Äî –∫–∞–∫–æ–π —Å—Ä–∞–∑—É –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é?', type: 'choice', options: ['–¢–æ–ª—å–∫–æ bind', 'call –∏ apply', '–í—Å–µ —Ç—Ä–∏'], correct: 1, hint: '–í—ã–∑–æ–≤', answer: 'call –∏ apply' },
      { text: '–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ __proto__ ‚Äî –∫–∞–∫–æ–µ?', type: 'choice', options: ['–ö–ª–∞—Å—Å–æ–≤–æ–µ', '–ü—Ä–æ—Ç–æ—Ç–∏–ø–Ω–æ–µ', '–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ'], correct: 1, hint: '–û—Ç prototype', answer: '–ü—Ä–æ—Ç–æ—Ç–∏–ø–Ω–æ–µ' }
    ];

    const QUESTIONS_BY_CATEGORY = {
      '–ê–ª–≥–æ—Ä–∏—Ç–º—ã': [
        { text: '–û–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ä–æ—Å—Ç–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ (Big O)?', type: 'short', placeholder: '–û–¥–Ω–æ —Å–ª–æ–≤–æ', hint: 'O –≤ —Å–∫–æ–±–∫–∞—Ö', answer: 'O(n)', image: 'https://picsum.photos/400/200?random=1' },
        { text: '–°–ª–æ–∂–Ω–æ—Å—Ç—å –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –≤ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –º–∞—Å—Å–∏–≤–µ?', type: 'choice', options: ['O(n)', 'O(log n)', 'O(n¬≤)'], correct: 1, hint: '–õ–æ–≥–∞—Ä–∏—Ñ–º', answer: 'O(log n)' },
        { text: '–°—Ç—Ä—É–∫—Ç—É—Ä–∞ LIFO ‚Äî –∫–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è?', type: 'short', placeholder: '–û–¥–Ω–æ —Å–ª–æ–≤–æ', hint: '–°—Ç–µ–∫ –ø–æ-–∞–Ω–≥–ª–∏–π—Å–∫–∏', answer: '—Å—Ç–µ–∫' },
        { text: '–°—Ç—Ä—É–∫—Ç—É—Ä–∞ FIFO ‚Äî –∫–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è?', type: 'short', placeholder: '–û–¥–Ω–æ —Å–ª–æ–≤–æ', hint: '–û—á–µ—Ä–µ–¥—å', answer: '–æ—á–µ—Ä–µ–¥—å' },
        { text: '–ë—ã—Å—Ç—Ä–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –≤ —Å—Ä–µ–¥–Ω–µ–º –∫–∞–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å?', type: 'choice', options: ['O(n¬≤)', 'O(n log n)', 'O(n)'], correct: 1, hint: 'n log n', answer: 'O(n log n)' },
        { text: '–•–µ—à-—Ç–∞–±–ª–∏—Ü–∞: —Å—Ä–µ–¥–Ω—è—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞?', type: 'choice', options: ['O(n)', 'O(1)', 'O(log n)'], correct: 1, hint: '–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞', answer: 'O(1)' },
        { text: '–†–µ–∫—É—Ä—Å–∏—è —Ç—Ä–µ–±—É–µ—Ç...', type: 'choice', options: ['–ë–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π', '–¢–æ–ª—å–∫–æ —Ü–∏–∫–ª', '–ù–∏—á–µ–≥–æ'], correct: 0, hint: '–£—Å–ª–æ–≤–∏–µ –≤—ã—Ö–æ–¥–∞', answer: '–ë–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π' },
        { text: '–ê–ª–≥–æ—Ä–∏—Ç–º –æ–±—Ö–æ–¥–∞ –¥–µ—Ä–µ–≤–∞ ¬´—Å–Ω–∞—á–∞–ª–∞ –∫–æ—Ä–µ–Ω—å¬ª?', type: 'short', placeholder: '–î–≤–∞ —Å–ª–æ–≤–∞', hint: 'Depth first...', answer: 'preorder' },
        { text: '–î–≤—É—Å–≤—è–∑–Ω—ã–π —Å–ø–∏—Å–æ–∫ ‚Äî —É —É–∑–ª–∞ —Å–∫–æ–ª—å–∫–æ —Å—Å—ã–ª–æ–∫?', type: 'choice', options: ['–û–¥–Ω–∞', '–î–≤–µ', '–¢—Ä–∏'], correct: 1, hint: '–ù–∞ –¥–≤–∞ —Å–æ—Å–µ–¥–∞', answer: '–î–≤–µ' },
        { text: '–ñ–∞–¥–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –≤—Å–µ–≥–¥–∞ –¥–∞—ë—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç?', type: 'choice', options: ['–î–∞', '–ù–µ—Ç'], correct: 1, hint: '–ù–µ –≤—Å–µ–≥–¥–∞', answer: '–ù–µ—Ç' }
      ],
      'JavaScript': QUESTIONS_DATA,
      'SQL': [
        { text: '–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–ª—è –≤—ã–±–æ—Ä–∫–∏ –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤?', type: 'short', placeholder: '–û–¥–Ω–æ —Å–ª–æ–≤–æ', hint: 'DISTINCT', answer: 'DISTINCT' },
        { text: 'JOIN –ø–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é –∫–ª—é—á–µ–π ‚Äî –∫–∞–∫–æ–π?', type: 'choice', options: ['LEFT JOIN', 'INNER JOIN', 'FULL JOIN'], correct: 1, hint: '–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π', answer: 'INNER JOIN', image: 'https://picsum.photos/400/200?random=2' },
        { text: '–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å—Ç—Ä–æ–∫ –ø–æ –ø–æ–ª—é ‚Äî –∫–∞–∫–∞—è –∫–ª–∞—É–∑–∞?', type: 'short', placeholder: '–î–≤–∞ —Å–ª–æ–≤–∞', hint: 'GROUP BY', answer: 'GROUP BY' },
        { text: '–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ GROUP BY ‚Äî –∫–∞–∫–∞—è –∫–ª–∞—É–∑–∞?', type: 'short', placeholder: '–î–≤–∞ —Å–ª–æ–≤–∞', hint: 'HAVING', answer: 'HAVING' },
        { text: 'NULL = NULL –≤ SQL –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç true?', type: 'choice', options: ['–î–∞', '–ù–µ—Ç', 'NULL (unknown)'], correct: 2, hint: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ', answer: 'NULL (unknown)' },
        { text: '–ò–Ω–¥–µ–∫—Å —É—Å–∫–æ—Ä—è–µ—Ç SELECT, –Ω–æ –∑–∞–º–µ–¥–ª—è–µ—Ç?', type: 'short', placeholder: '–û–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è', hint: 'INSERT/UPDATE', answer: 'INSERT' },
        { text: '–ü–æ–¥–∑–∞–ø—Ä–æ—Å –≤ FROM ‚Äî —ç—Ç–æ?', type: 'choice', options: ['CTE', '–ü–æ–¥–∑–∞–ø—Ä–æ—Å-—Ç–∞–±–ª–∏—Ü–∞', 'VIEW'], correct: 1, hint: '–í—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞', answer: '–ü–æ–¥–∑–∞–ø—Ä–æ—Å-—Ç–∞–±–ª–∏—Ü–∞' },
        { text: '–ê–≥—Ä–µ–≥–∞—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ —Å—Ç—Ä–æ–∫?', type: 'short', placeholder: 'COUNT', hint: 'COUNT', answer: 'COUNT' },
        { text: 'UNION —É–¥–∞–ª—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?', type: 'choice', options: ['–î–∞', '–ù–µ—Ç'], correct: 0, hint: '–î–∞', answer: '–î–∞' },
        { text: '–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî –∫–∞–∫–∞—è –∫–æ–º–∞–Ω–¥–∞?', type: 'short', placeholder: 'ROLLBACK', hint: '–û—Ç–∫–∞—Ç', answer: 'ROLLBACK' }
      ],
      '–ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ': [
        { text: '–ú–µ—Ç–æ–¥ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ –æ–ø—ã—Ç (–∞–∫—Ä–æ–Ω–∏–º)?', type: 'short', placeholder: '4 –±—É–∫–≤—ã', hint: 'STAR', answer: 'STAR', image: 'https://picsum.photos/400/200?random=3' },
        { text: 'S –≤ STAR ‚Äî —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç?', type: 'choice', options: ['Situation', 'Solution', 'Summary'], correct: 0, hint: '–°–∏—Ç—É–∞—Ü–∏—è', answer: 'Situation' },
        { text: '–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ —Å –∫–æ–ª–ª–µ–≥–æ–π ‚Äî —á—Ç–æ –≤–∞–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å?', type: 'choice', options: ['–¢–æ–ª—å–∫–æ —Å–≤–æ—é –ø—Ä–∞–≤–æ—Ç—É', '–ö–æ–º–ø—Ä–æ–º–∏—Å—Å –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç', '–ö—Ç–æ –≤–∏–Ω–æ–≤–∞—Ç'], correct: 1, hint: '–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ', answer: '–ö–æ–º–ø—Ä–æ–º–∏—Å—Å –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç' },
        { text: '–ü–æ—á–µ–º—É —Ö–æ—Ç–∏—Ç–µ —Å–º–µ–Ω–∏—Ç—å —Ä–∞–±–æ—Ç—É? ‚Äî –ª—É—á—à–µ –æ—Ç–≤–µ—á–∞—Ç—å...', type: 'choice', options: ['–ö—Ä–∏—Ç–∏–∫–æ–π —Ç–µ–∫—É—â–µ–π –∫–æ–º–ø–∞–Ω–∏–∏', '–ö–∞—Ä—å–µ—Ä–Ω—ã–º–∏ —Ü–µ–ª—è–º–∏', '–î–µ–Ω—å–≥–∞–º–∏'], correct: 1, hint: '–ü–æ–∑–∏—Ç–∏–≤', answer: '–ö–∞—Ä—å–µ—Ä–Ω—ã–º–∏ —Ü–µ–ª—è–º–∏' },
        { text: '–í–∞—à–∞ –≥–ª–∞–≤–Ω–∞—è —Å–ª–∞–±–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ ‚Äî –∫–∞–∫ –ª—É—á—à–µ –ø–æ–¥–∞—Ç—å?', type: 'short', placeholder: '2‚Äì3 —Å–ª–æ–≤–∞', hint: '–° —É–ª—É—á—à–µ–Ω–∏–µ–º', answer: '—Å –ø–ª–∞–Ω–æ–º —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –Ω–µ–π' },
        { text: '–í–æ–ø—Ä–æ—Å ¬´–ö—É–¥–∞ –≤–∏–¥–∏—Ç–µ —Å–µ–±—è —á–µ—Ä–µ–∑ 5 –ª–µ—Ç?¬ª ‚Äî —Ü–µ–ª—å –æ—Ç–≤–µ—Ç–∞?', type: 'choice', options: ['–§–∞–Ω—Ç–∞–∑–∏–∏', '–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ü–µ–ª—è–º –∫–æ–º–ø–∞–Ω–∏–∏', '–ó–∞—Ä–ø–ª–∞—Ç–∞'], correct: 1, hint: '–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å', answer: '–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ü–µ–ª—è–º –∫–æ–º–ø–∞–Ω–∏–∏' },
        { text: '–ü—Ä–∏ –¥–µ–¥–ª–∞–π–Ω–µ –∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ ‚Äî —á—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å?', type: 'choice', options: ['–ü–∞–Ω–∏–∫—É', '–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—é', '–ü–µ—Ä–µ–∫–ª–∞–¥—ã–≤–∞–Ω–∏–µ'], correct: 1, hint: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ', answer: '–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—é' },
        { text: '–ü–æ—á–µ–º—É –º—ã –¥–æ–ª–∂–Ω—ã –≤–∑—è—Ç—å –∏–º–µ–Ω–Ω–æ –≤–∞—Å? ‚Äî –∫–ª—é—á–µ–≤–æ–π –ø–æ—Å—ã–ª:', type: 'short', placeholder: '1‚Äì2 —Å–ª–æ–≤–∞', hint: '–£–Ω–∏–∫–∞–ª—å–Ω–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å', answer: '—É–Ω–∏–∫–∞–ª—å–Ω–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å' },
        { text: '–í–æ–ø—Ä–æ—Å –æ –∑–∞—Ä–ø–ª–∞—Ç–µ ‚Äî –∫–æ–≥–¥–∞ –ª—É—á—à–µ –æ–∑–≤—É—á–∏–≤–∞—Ç—å?', type: 'choice', options: ['–í –Ω–∞—á–∞–ª–µ', '–ü–æ—Å–ª–µ –æ—Ñ—Ñ–µ—Ä–∞', '–ö–æ–≥–¥–∞ —Å–ø—Ä–æ—Å—è—Ç'], correct: 2, hint: '–ö–æ–≥–¥–∞ —Å–ø—Ä–æ—Å—è—Ç', answer: '–ö–æ–≥–¥–∞ —Å–ø—Ä–æ—Å—è—Ç' },
        { text: '–û—à–∏–±–∫–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ ‚Äî –ø–µ—Ä–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ?', type: 'choice', options: ['–°–∫—Ä—ã—Ç—å', '–°–æ–æ–±—â–∏—Ç—å –∫–æ–º–∞–Ω–¥–µ', '–ò—Å–ø—Ä–∞–≤–∏—Ç—å –º–æ–ª—á–∞'], correct: 1, hint: '–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è', answer: '–°–æ–æ–±—â–∏—Ç—å –∫–æ–º–∞–Ω–¥–µ' }
      ]
    };

    const FAVORITES_QUESTIONS = [
      { text: 'let –∏ const ‚Äî –∫–∞–∫–æ–π –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∏—Ç—å?', type: 'short', placeholder: '–û–¥–Ω–æ —Å–ª–æ–≤–æ', hint: 'Constant', answer: 'const' },
      { text: '–ü–∞—Ç—Ç–µ—Ä–Ω —Å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–º –∫–ª–∞—Å—Å–∞?', type: 'short', placeholder: '–û–¥–Ω–æ —Å–ª–æ–≤–æ', hint: 'Single', answer: 'Singleton' },
      { text: 'Virtual DOM ‚Äî —ç—Ç–æ –∫–æ–ø–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ DOM –≤ –ø–∞–º—è—Ç–∏?', type: 'choice', options: ['–î–∞', '–ù–µ—Ç'], correct: 0, hint: '–í –ø–∞–º—è—Ç–∏', answer: '–î–∞' }
    ];

    let state = {
      isLoggedIn: false,
      userName: '–ê–ª–µ–∫—Å–µ–π',
      userEmail: 'alexey@example.com',
      prevScreenBeforeProfile: 1,
      role: null,
      roleLabel: null,
      level: null,
      questionsContext: { type: 'company', name: '–¢-–ë–∞–Ω–∫' },
      currentQuestion: 1,
      totalQuestions: TOTAL_QUESTIONS,
      fromFavorites: false,
      inRowMode: false,
      isFavoritesTest: false,
      currentQuestions: QUESTIONS_DATA,
      testAnswers: [],
      answered: false,
      favorite: false
    };

    function getLevelLabel() {
      const l = state.level || 'junior';
      return l === 'junior' ? '–î–∂—É–Ω–∏–æ—Ä' : l === 'middle' ? '–ú–∏–¥–ª' : '–°–µ–Ω—å–æ—Ä';
    }

    function showScreen(num) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById('screen-' + num).classList.add('active');
      const topBar = document.getElementById('top-bar');
      topBar.classList.toggle('visible', state.isLoggedIn && num !== 0);
      const titleEl = document.getElementById('top-bar-title');
      if (titleEl) {
        if (num === 2) titleEl.textContent = '–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ ‚Ä¢ ' + (state.roleLabel || 'Frontend') + ' ‚Ä¢ ' + getLevelLabel();
        else if (num === 5) titleEl.textContent = state.questionsContext ? (state.questionsContext.name + (state.questionsContext.type === 'favorites' ? '' : ' ‚Ä¢ ' + getLevelLabel())) : '';
        else if (num === 6) titleEl.textContent = state.questionsContext && state.currentQuestion ? `–í–æ–ø—Ä–æ—Å ${state.currentQuestion} –∏–∑ ${state.totalQuestions} ‚Ä¢ ${state.questionsContext.name}${state.isFavoritesTest ? '' : ' ‚Ä¢ ' + getLevelLabel()}` : '';
        else {
          const titles = { 1: '–ö —á–µ–º—É –≥–æ—Ç–æ–≤–∏—à—å—Å—è?', 3: '–ü–æ –∫–æ–º–ø–∞–Ω–∏—è–º', 4: '–ö–∞—Ç–µ–≥–æ—Ä–∏–∏', 7: '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ', 8: '–ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å', 9: '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞', 10: '–ü—Ä–æ—Ñ–∏–ª—å' };
          titleEl.textContent = titles[num] || '';
        }
      }
      const backBtn = document.getElementById('top-bar-back');
      if (backBtn) backBtn.style.display = (state.isLoggedIn && num >= 2) ? 'flex' : 'none';
      if (num === 1) {
        if (state.role) document.querySelectorAll('#roles-grid .card').forEach(c => c.classList.toggle('selected', c.dataset.role === state.role));
        if (state.level) document.querySelectorAll('#screen1-level-chips .chip').forEach(c => c.classList.toggle('active', c.dataset.level === state.level));
        updateContinueButton();
      } else if (num === 3) document.getElementById('companies-level').textContent = getLevelLabel();
      else if (num === 4) document.getElementById('categories-level').textContent = getLevelLabel();
      else if (num === 8) {
        document.getElementById('progress-role-chip').textContent = (state.roleLabel || 'Frontend') + ' ‚Ä¢ ' + getLevelLabel();
        const prog = PROGRESS_BY_LEVEL[state.level || 'junior'] || { done: 0, total: 40 };
        const pct = prog.total ? Math.round((prog.done / prog.total) * 100) : 0;
        document.getElementById('progress-overall-bar').style.width = pct + '%';
        document.getElementById('progress-overall-text').textContent = `–†–µ—à–µ–Ω–æ ${prog.done} –∏–∑ ${prog.total} –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Ä¢ ${pct}%`;
      }
    }

    const PROGRESS_BY_LEVEL = { junior: { done: 12, total: 40 }, middle: { done: 0, total: 40 }, senior: { done: 0, total: 40 } };

    function updateContinueButton() {
      document.getElementById('btn-continue').disabled = !(state.role && state.level);
    }

    function updateHubHeader() {
      const levelLabel = state.level === 'junior' ? '–î–∂—É–Ω–∏–æ—Ä' : state.level === 'middle' ? '–ú–∏–¥–ª' : '–°–µ–Ω—å–æ—Ä';
      const prog = PROGRESS_BY_LEVEL[state.level] || { done: 0, total: 40 };
      const pct = prog.total ? Math.round((prog.done / prog.total) * 100) : 0;
      document.getElementById('hub-progress').textContent = `–†–µ—à–µ–Ω–æ ${prog.done} –∏–∑ ${prog.total} ‚Ä¢ ${pct}%`;
      document.getElementById('hub-progress-bar').style.width = pct + '%';
      const titleEl = document.getElementById('top-bar-title');
      if (titleEl && document.getElementById('screen-2').classList.contains('active')) titleEl.textContent = '–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ ‚Ä¢ ' + (state.roleLabel || 'Frontend') + ' ‚Ä¢ ' + levelLabel;
    }

    document.getElementById('roles-grid').addEventListener('click', (e) => {
      const card = e.target.closest('.card');
      if (!card) return;
      document.querySelectorAll('#roles-grid .card').forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
      state.role = card.dataset.role;
      state.roleLabel = card.querySelector('.card-title').textContent;
      updateContinueButton();
    });

    document.getElementById('screen1-level-chips').addEventListener('click', (e) => {
      const chip = e.target.closest('.chip');
      if (!chip) return;
      state.level = chip.dataset.level;
      chip.parentElement.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
      chip.classList.add('active');
      updateContinueButton();
    });

    function doLogin() {
      const login = document.getElementById('login-input').value.trim();
      const password = document.getElementById('password-input').value;
      if (login && password) {
        state.isLoggedIn = true;
        state.userName = login.charAt(0).toUpperCase() + login.slice(1).toLowerCase();
        document.getElementById('user-name').textContent = state.userName;
        document.getElementById('profile-name').textContent = state.userName;
        document.getElementById('login-input').value = '';
        document.getElementById('password-input').value = '';
        showScreen(1);
      }
    }

    function logout() {
      state.isLoggedIn = false;
      document.getElementById('top-bar').classList.remove('visible');
      showScreen(0);
    }

    function showProfile() {
      state.prevScreenBeforeProfile = parseInt(document.querySelector('.screen.active').id.replace('screen-', ''));
      document.getElementById('profile-name').textContent = state.userName;
      document.getElementById('profile-email').textContent = state.userEmail;
      showScreen(10);
    }

    function goBackFromProfile() {
      showScreen(state.prevScreenBeforeProfile);
    }

    function handleTopBarBack() {
      const active = document.querySelector('.screen.active');
      if (!active) return;
      const n = parseInt(active.id.replace('screen-', ''));
      if (n === 2) showScreen(1);
      else if (n === 3 || n === 4 || n === 7 || n === 8) showScreen(2);
      else if (n === 5) backFromQuestions();
      else if (n === 6) backToQuestionsList();
      else if (n === 9) backFromTestResult();
      else if (n === 10) goBackFromProfile();
    }

    function toggleUserMenu(e) {
      e.stopPropagation();
      document.getElementById('user-menu').classList.toggle('open');
    }

    function closeUserMenu() {
      document.getElementById('user-menu').classList.remove('open');
    }

    document.addEventListener('click', (e) => {
      if (!e.target.closest('.user-dropdown')) {
        document.getElementById('user-menu').classList.remove('open');
      }
    });

    document.getElementById('btn-continue').addEventListener('click', () => {
      document.querySelectorAll('#screen1-level-chips .chip').forEach(c => {
        c.classList.toggle('active', c.dataset.level === state.level);
      });
      updateHubHeader();
      showScreen(2);
    });

    function getQuestionsForContext() {
      if (state.questionsContext.type === 'category' && QUESTIONS_BY_CATEGORY[state.questionsContext.name]) {
        return QUESTIONS_BY_CATEGORY[state.questionsContext.name];
      }
      return QUESTIONS_DATA;
    }

    function renderQuestionsList() {
      const questions = getQuestionsForContext();
      const html = questions.map((q, i) => {
        const thumb = q.image ? '<img class="question-thumb" src="' + q.image + '" alt="">' : '';
        return '<div class="question-item" onclick="openQuestion(' + (i + 1) + ')">' +
          '<span class="question-num">' + (i + 1) + '</span>' +
          thumb +
          '<span class="question-preview">' + (q.text.length > 45 ? q.text.slice(0, 42) + '‚Ä¶' : q.text) + '</span>' +
          '<span class="star">‚òÜ</span>' +
          '<span class="question-status" style="color:var(--text-muted)">‚Äî</span></div>';
      }).join('');
      document.getElementById('questions-list').innerHTML = html;
    }

    function openQuestions(type, name) {
      state.questionsContext = { type, name };
      const levelLabel = (state.level || 'junior') === 'junior' ? '–î–∂—É–Ω–∏–æ—Ä' : (state.level || 'junior') === 'middle' ? '–ú–∏–¥–ª' : '–°–µ–Ω—å–æ—Ä';
      const topTitle = document.getElementById('top-bar-title');
      if (topTitle) topTitle.textContent = name + (type === 'favorites' ? '' : ' ‚Ä¢ ' + levelLabel);
      state.fromFavorites = false;
      renderQuestionsList();
      showScreen(5);
    }

    function backFromQuestions() {
      if (state.questionsContext.type === 'company') showScreen(3);
      else if (state.questionsContext.type === 'favorites') showScreen(7);
      else showScreen(4);
    }

    function getCurrentQuestion() {
      return state.currentQuestions[state.currentQuestion - 1];
    }

    function renderAnswerArea() {
      const q = getCurrentQuestion();
      const container = document.getElementById('answer-input-area');
      container.innerHTML = '';
      if (q.type === 'short') {
        container.innerHTML = '<p style="margin-bottom:8px;font-size:0.9rem;color:var(--text-muted)">–í–∞—à –æ—Ç–≤–µ—Ç:</p><input type="text" id="user-answer" placeholder="' + (q.placeholder || '–ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç') + '">';
      } else if (q.type === 'choice') {
        container.innerHTML = '<p style="margin-bottom:8px;font-size:0.9rem;color:var(--text-muted)">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–≤–µ—Ç:</p>' +
          q.options.map((opt, i) => '<div class="radio-option" data-idx="' + i + '" onclick="selectOption(this)">' + opt + '</div>').join('');
      }
    }

    function selectOption(el) {
      document.querySelectorAll('#answer-input-area .radio-option').forEach(o => o.classList.remove('selected'));
      el.classList.add('selected');
      state.selectedOption = parseInt(el.dataset.idx);
    }

    function renderQuestionCard() {
      const q = getCurrentQuestion();
      const levelLabel = (state.level || 'junior') === 'junior' ? '–î–∂—É–Ω–∏–æ—Ä' : (state.level || 'junior') === 'middle' ? '–ú–∏–¥–ª' : '–°–µ–Ω—å–æ—Ä';
      const ctx = state.questionsContext.name + (state.isFavoritesTest ? '' : ' ‚Ä¢ ' + levelLabel);

      const topTitle = document.getElementById('top-bar-title');
      if (topTitle) topTitle.textContent = `–í–æ–ø—Ä–æ—Å ${state.currentQuestion} –∏–∑ ${state.totalQuestions} ‚Ä¢ ${ctx}`;
      document.getElementById('question-text').textContent = q.text;
      const imgWrap = document.getElementById('question-image-wrap');
      imgWrap.innerHTML = q.image ? '<img class="question-image" src="' + q.image + '" alt="">' : '';
      document.getElementById('hint-block').textContent = '–ü–æ–¥—Å–∫–∞–∑–∫–∞: ' + q.hint;
      document.getElementById('correct-answer-text').textContent = q.answer;
      renderAnswerArea();
      document.getElementById('btn-next-question').textContent = '–°–ª–µ–¥—É—é—â–∏–π ‚Üí';
    }

    function startQuestionsInRow() {
      state.currentQuestion = 1;
      state.answered = false;
      state.inRowMode = true;
      state.isFavoritesTest = false;
      state.currentQuestions = getQuestionsForContext();
      state.totalQuestions = state.currentQuestions.length;
      state.testAnswers = [];
      document.getElementById('answer-area').style.display = 'block';
      document.getElementById('result-area').style.display = 'none';
      document.getElementById('hint-block').style.display = 'none';
      renderQuestionCard();
      showScreen(6);
    }

    function startFavoritesTest() {
      state.currentQuestion = 1;
      state.answered = false;
      state.inRowMode = true;
      state.isFavoritesTest = true;
      state.currentQuestions = FAVORITES_QUESTIONS;
      state.totalQuestions = FAVORITES_QUESTIONS.length;
      state.questionsContext = { type: 'favorites', name: '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ' };
      state.testAnswers = [];
      document.getElementById('answer-area').style.display = 'block';
      document.getElementById('result-area').style.display = 'none';
      document.getElementById('hint-block').style.display = 'none';
      renderQuestionCard();
      showScreen(6);
    }

    function openQuestion(num) {
      state.currentQuestion = num;
      state.answered = false;
      state.fromFavorites = false;
      state.inRowMode = false;
      state.isFavoritesTest = false;
      state.currentQuestions = getQuestionsForContext();
      state.totalQuestions = state.currentQuestions.length;
      document.getElementById('answer-area').style.display = 'block';
      document.getElementById('result-area').style.display = 'none';
      document.getElementById('hint-block').style.display = 'none';
      renderQuestionCard();
      showScreen(6);
    }

    function openQuestionFromFav(num) {
      state.currentQuestion = num;
      state.answered = false;
      state.fromFavorites = true;
      state.inRowMode = false;
      state.currentQuestions = FAVORITES_QUESTIONS;
      state.totalQuestions = FAVORITES_QUESTIONS.length;
      state.questionsContext = { type: 'favorites', name: '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ' };
      document.getElementById('answer-area').style.display = 'block';
      document.getElementById('result-area').style.display = 'none';
      document.getElementById('hint-block').style.display = 'none';
      renderQuestionCard();
      showScreen(6);
    }

    function backToQuestionsList() {
      if (state.fromFavorites || state.isFavoritesTest) showScreen(7);
      else showScreen(5);
    }

    function toggleHint() {
      const block = document.getElementById('hint-block');
      block.style.display = block.style.display === 'none' ? 'block' : 'none';
    }

    function checkAnswer() {
      const q = getCurrentQuestion();
      let isCorrect = false;
      if (q.type === 'short') {
        const ans = (document.getElementById('user-answer')?.value || '').trim().toLowerCase();
        const correctAns = q.answer.toLowerCase();
        isCorrect = ans && (correctAns.includes(ans) || correctAns.split(/[,\s]+/).some(a => a.startsWith(ans) || ans.startsWith(a)));
        if (!isCorrect && ans.length > 0) isCorrect = Math.random() > 0.7;
      } else {
        isCorrect = state.selectedOption !== undefined && state.selectedOption === q.correct;
      }
      state.answered = true;
      if (state.inRowMode) {
        state.testAnswers[state.currentQuestion - 1] = isCorrect;
      }
      document.getElementById('answer-area').style.display = 'none';
      document.getElementById('result-area').style.display = 'block';
      document.getElementById('correct-answer-block').className = 'answer-block ' + (isCorrect ? '' : 'incorrect');
      const nextBtn = document.getElementById('btn-next-question');
      if (state.inRowMode && state.currentQuestion === state.totalQuestions) {
        nextBtn.textContent = '–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚Üí';
      }
    }

    function prevQuestion() {
      if (state.currentQuestion <= 1) return;
      state.currentQuestion--;
      state.answered = true;
      document.getElementById('answer-area').style.display = 'none';
      document.getElementById('result-area').style.display = 'block';
      const wasCorrect = state.inRowMode && state.testAnswers[state.currentQuestion - 1];
      document.getElementById('correct-answer-block').className = 'answer-block ' + (wasCorrect !== false ? '' : 'incorrect');
      document.getElementById('correct-answer-text').textContent = getCurrentQuestion().answer;
      renderQuestionCard();
      document.getElementById('answer-area').style.display = 'none';
      document.getElementById('result-area').style.display = 'block';
      document.getElementById('btn-next-question').textContent = state.currentQuestion === state.totalQuestions ? '–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚Üí' : '–°–ª–µ–¥—É—é—â–∏–π ‚Üí';
    }

    function nextQuestion() {
      if (state.inRowMode && state.currentQuestion === state.totalQuestions) {
        showTestResult();
        return;
      }
      if (state.currentQuestion < state.totalQuestions) {
        state.currentQuestion++;
        state.answered = false;
        state.selectedOption = null;
        document.getElementById('answer-area').style.display = 'block';
        document.getElementById('result-area').style.display = 'none';
        document.getElementById('hint-block').style.display = 'none';
        renderQuestionCard();
        document.getElementById('btn-next-question').textContent = '–°–ª–µ–¥—É—é—â–∏–π ‚Üí';
      }
    }

    function showTestResult() {
      const total = state.totalQuestions;
      const correctCount = state.testAnswers.filter(Boolean).length;
      const percent = Math.round((correctCount / total) * 100);
      const lvl = state.level || 'junior';
      const ctx = state.isFavoritesTest ? state.questionsContext.name : `${state.questionsContext.name} ‚Ä¢ ${lvl === 'junior' ? '–î–∂—É–Ω–∏–æ—Ä' : lvl === 'middle' ? '–ú–∏–¥–ª' : '–°–µ–Ω—å–æ—Ä'}`;

      document.getElementById('result-score').textContent = `${correctCount}/${total}`;
      document.getElementById('result-detail').textContent = `${percent}% –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤`;
      document.getElementById('result-context').textContent = ctx;

      let icon = 'üìä', title = '–¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω!';
      if (percent >= 80) { icon = 'üéâ'; title = '–û—Ç–ª–∏—á–Ω–æ!'; }
      else if (percent >= 60) { icon = 'üëç'; title = '–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!'; }
      else if (percent >= 40) { icon = 'üìñ'; title = '–ï—Å—Ç—å –∫—É–¥–∞ —Ä–∞—Å—Ç–∏'; }
      else { icon = 'üí™'; title = '–ü—Ä–æ–¥–æ–ª–∂–∞–π –≥–æ—Ç–æ–≤–∏—Ç—å—Å—è!'; }
      document.getElementById('result-icon').textContent = icon;
      document.getElementById('result-title').textContent = title;

      document.getElementById('btn-retake').style.display = state.isFavoritesTest ? 'flex' : 'flex';
      document.getElementById('btn-retake').textContent = '–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –µ—â—ë —Ä–∞–∑';
      document.getElementById('btn-retake').onclick = state.isFavoritesTest ? startFavoritesTest : retakeTest;
      document.getElementById('btn-to-list').onclick = state.isFavoritesTest ? () => showScreen(7) : backToQuestionsFromResult;
      document.getElementById('btn-to-list').textContent = state.isFavoritesTest ? '–ö –∏–∑–±—Ä–∞–Ω–Ω–æ–º—É' : '–ö —Å–ø–∏—Å–∫—É –≤–æ–ø—Ä–æ—Å–æ–≤';

      showScreen(9);
    }

    function backFromTestResult() {
      if (state.isFavoritesTest) showScreen(7);
      else showScreen(5);
    }

    function retakeTest() {
      if (state.isFavoritesTest) startFavoritesTest();
      else startQuestionsInRow();
    }

    function backToQuestionsFromResult() {
      showScreen(5);
    }

    function showScreenFromResult() {
      if (state.isFavoritesTest) showScreen(7);
      else showScreen(2);
    }

    function toggleFavorite() {
      state.favorite = !state.favorite;
      document.getElementById('fav-star').textContent = state.favorite ? '‚òÖ' : '‚òÜ';
      document.getElementById('fav-star').classList.toggle('filled', state.favorite);
    }

    function removeFavorite(btn) {
      const card = btn.closest('.card');
      card.remove();
      const cards = document.querySelectorAll('#favorites-list .card');
      if (cards.length === 0) {
        document.getElementById('favorites-list').style.display = 'none';
        document.getElementById('favorites-empty').style.display = 'block';
      }
    }
  </script>
</body>
</html>
